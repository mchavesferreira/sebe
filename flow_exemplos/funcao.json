[{"id":"9a571eb2101bf572","type":"function","z":"f905dc84c7b6668c","name":"function 3","func":"// Função Node-RED: separar payload de estação meteorológica e converter unidades\n\n// 1. Lê a string de entrada\nvar input = msg.payload;\n\n// 2. Cria objeto para armazenar chaves e valores\nvar data = {};\n\n// 3. Percorre cada par “chave=valor”\ninput.split('&').forEach(function (pair) {\n    var parts = pair.split('=');\n    var key = parts[0];\n    var raw = decodeURIComponent(parts[1] || '');\n    var value;\n\n    switch (key) {\n        case 'dateutc':\n            // — parse UTC e aplica offset de –3h\n            var d = new Date(raw.replace(' ', 'T') + 'Z');\n            d.setHours(d.getHours() - 3);\n            // — formata em “YYYY-MM-DD HH:mm:ss”\n            var pad = function (n) { return n < 10 ? '0' + n : n; };\n            value = d.getFullYear() + '-'\n                + pad(d.getMonth() + 1) + '-'\n                + pad(d.getDate()) + ' '\n                + pad(d.getHours()) + ':'\n                + pad(d.getMinutes()) + ':'\n                + pad(d.getSeconds());\n            break;\n\n        case 'tempinf':\n            // — converte °F → °C\n            var f = Number(raw);\n            value = Math.round((f - 32) * 5 / 9 * 100) / 100;\n            break;\n\n        case 'baromrelin':\n            // — converte hPa → mmHg (1 hPa ≃ 0,750062 mmHg)\n          var inhg = Number(raw);\n         value = Math.round(inhg * 25.4 * 100) / 100;\n         break;\n\n        case 'maxdailygus':\n            // — converte mph → km/h (1 mph ≃ 1,60934 km/h)\n            var mphy = Number(raw);\n            value = Math.round(mphy * 1.60934 * 100) / 100;\n            break;\n        case 'windgustmph':\n            // — converte mph → km/h (1 mph ≃ 1,60934 km/h)\n            var mphx = Number(raw);\n            value = Math.round(mphx * 1.60934 * 100) / 100;\n\n            break;\n   case 'windspeedmph':\n            // — converte mph → km/h (1 mph ≃ 1,60934 km/h)\n            var mph = Number(raw);\n            value = Math.round(mph * 1.60934 * 100) / 100;\n            break;\n                 case 'drain_piezo':\n            // — converte mph → km/h (1 mph ≃ 1,60934 km/h)\n            var fee = Number(raw);              // valor bruto em polegadas\n            value = +(fee * 25.4).toFixed(2); // resultado em mm\n            break;\n\n                 case 'mrain_piezo':\n            // — converte mph → km/h (1 mph ≃ 1,60934 km/h)\n            var fee = Number(raw);              // valor bruto em polegadas\n            value = +(fee * 25.4).toFixed(2); // resultado em mm\n            break;\n\n            case 'hrain_piezo':\n            // — converte altura de chuva: polegadas → milímetros (1 in = 25,4 mm)\n            var fee = Number(raw);              // valor bruto em polegadas\n            value = +(fee * 25.4).toFixed(2); // resultado em mm\n            break;\n\n\n\n          case 'rrain_piezo':\n            // — converte mph → km/h (1 mph ≃ 1,60934 km/h)\n            var fee = Number(raw);              // valor bruto em polegadas\n            value = +(fee * 25.4).toFixed(2); // resultado em mm\n            break;\n\n        case 'erain_piezo':\n            // — converte mph → km/h (1 mph ≃ 1,60934 km/h)\n            var fee = Number(raw);              // valor bruto em polegadas\n            value = +(fee * 25.4).toFixed(2); // resultado em mm\n            break;\n\n       case 'wrain_piezo':\n            // — converte mph → km/h (1 mph ≃ 1,60934 km/h)\n            var fee = Number(raw);              // valor bruto em polegadas\n            value = +(fee * 25.4).toFixed(2); // resultado em mm\n            break;\n\n        default:\n            // — tenta converter em número; se não, mantém string\n            var num = Number(raw);\n            value = !isNaN(num) ? num : raw;\n    }\n\n    data[key] = value;\n});\n\n// 4. Atribui o objeto convertido a msg.payload\nmsg.payload = data;\nreturn msg;\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":360,"y":340,"wires":[["e83e014015eb70c3","a6e31a87f63256d2"]]}]